# Funnel
고객이 제품이나 서비스를 인지하고 구매하기까지의 여정을 단계별로 나눈 구조

## 퍼널 분석의 흐름
1. 서비스, 비즈니스 파악: 서비스의 목표, 기획서
2. 문제 정의: 핵심 문제, 목표 정의
3. 퍼널 정의: 퍼널 매핑, 퍼널 별 핵심 이벤트 정의
4. 퍼널 분석: SQL 쿼리 작성, 의사 결정(개선 순서-퍼널의 뒷 부분, 이탈률이 높은 부분)
5. 팀 공유: 가설 도출, 아이디어
6. 기능 개발 및 배포: AB Test, 지표 모니터링

## 퍼널 정의 방법
1. 이벤트가 명시적으로 존재하는 경우
    - 이벤트의 조합으로 사용
2. 명시적으로 존재하진 않으나, 모든 페이지의 view가 존재하는 경우
    - 페이지의 view를 기준으로 퍼널을 정의
    - view 이벤트, 커스텀 이벤트 등을 모두 활용

## 퍼널의 종류
1. Open 퍼널
    - 유저의 이벤트 행동 순서에 상관없이 집계
    - 모든 단계에서 시작될 수 있다고 가정
    - 원클릭 결제 등이 있다면 특정 순서를 넘길 수 있음
2. Closed 퍼널
    - 유저가 정해진 단계를 순서대로 거쳐야 집계
    - 엄격한 순서를 거쳐야 함
    - 다음 단계가 항상 이전 단계보다 작거나 같음
    - 대부분의 분석 도구에서 활용
  
### SQL 쿼리 상에서 Open/Closed 퍼널의 차이
- Closed 퍼널: 유저의 로그 데이터를 기반으로 앞선 퍼널의 이벤트가 먼저 진행되었는지 확인
- Open 퍼널: 해당 이벤트가 존재하는지만 파악

## 퍼널의 선택
1. Open 퍼널
    - 유연한 유저의 여정: 다양하게 진입할 수 있는 경우
    - 광범위한 분석: 시작 위치와 관계없이 모든 사용자의 상호 작용을 파악하고 싶은 경우
    - 최초의 큰 그림을 보고 싶은 경우
2. Closed 퍼널
    - 유저의 흐름이 고정되어 있는 경우
    - 모든 단계가 순서대로 완료되어야 하는 경우
    - 순차적으로 해야하며, 앞선 조건이 엄격한 경우
  
## 지표 집계 단위
1. 유저(User) 별 집계: 고유한 사용자의 수
2. 페이지뷰(Page View) 별 집계: 페이지뷰 이벤트가 발생한 횟수
3. 세션(Session) 별 집계
    - 세션: 웹이나 앱에 사용자가 접속한 시점부터 이탈할 때의 활동
    - 동일한 유저가 세션 종료 후, 다른 시간에 접속하면 하나의 새로운 세션이 시작
    - 일정 시간 동안 유저의 활동이 없으면 세션이 종료된 것으로 간주
    - 유저가 서비스를 명시적으로 종료(로그아웃 등)하면 세션 종료로 간주
4. 여러 차원(Dimension)으로 집계 (시간축, 지역, 인구 통계 등)

## 세션에서 생각할 부분
1. 세션을 어떻게 만드는가?
    - session_id가 존재하는 경우: 해당 세션을 사용, session이 어떤 기준으로 만들어지는지 확인
    - session_id가 없는 경우: 사용자의 로그 기반으로 세션을 직접 생성
2. 일자가 바뀌는 시점에 세션을 어떻게 처리하는가?
    - 일자가 넘어가는 시점에 걸쳐서 세션이 존재하는 경우 처리가 어려울 수 있음
3. 세션을 꼭 사용해야 하는가?
4. '이탈'이라는 이벤트가 명시적으로 발생할까?

## 유저를 식별하는 방법
1. user_id
    - 로그인을 한 상태에서만 존재함
2. device_id
    - 사용자의 기기를 고유하게 식별
    - 앱은 고유 식별자(IDFA, GAID) 수집, 웹은 쿠기 등을 사용
    - 기기를 변경하거나 앱을 재설치하면 새로운 id가 생성되며 수집 동의를 받아야 함
3. user_pseudo_id
    - NULL이 없어서 GA/Firebase 데이터에서 유저를 식별할 때 제일 많이 사용되는 기준
